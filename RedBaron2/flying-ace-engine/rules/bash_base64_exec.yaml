name: bash_base64_execute
mode: alert
eval: |
  (
    (e.process_name == "bash" || e.process_name == "sh") &&
    re_match(e.process_args.to_lower(), "base64") &&
    re_match(e.process_args, "(\\||sh|bash|eval)")
  )
tests:
  - cleartext: "bash -c 'echo YmFkCg== | base64 -d | sh'"
    process_name: bash
    process_args: "bash -c echo YmFkCg== | base64 -d | sh"
    should_match: true
  - cleartext: "sh -c 'echo payload | base64 -d | bash'"
    process_name: sh
    process_args: "sh -c echo payload | base64 -d | bash"
    should_match: true
  - cleartext: "bash -c 'echo dGVzdAo= | base64 --decode | eval'"
    process_name: bash
    process_args: "bash -c echo dGVzdAo= | base64 --decode | eval"
    should_match: true
  - cleartext: "base64 /etc/passwd (just encoding, no exec)"
    process_name: base64
    process_args: "base64 /etc/passwd"
    should_match: false
  - cleartext: "bash script.sh (no base64)"
    process_name: bash
    process_args: "bash script.sh"
    should_match: false
